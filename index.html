<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Ø§Ù„ÙƒØªØ§Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</title><script src="https://cdn.tailwindcss.com"></script><style>@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap'); body { font-family: 'Cairo', sans-serif; direction: rtl; background: #000000; min-height: 100vh; } .form-container { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1); } .input-field { transition: all 0.3s ease; border: 2px solid #e2e8f0; } .input-field:focus { border-color: #6b7280; box-shadow: 0 0 0 3px rgba(107, 114, 128, 0.1); transform: translateY(-1px); } .btn-primary { background: linear-gradient(135deg, #1f2937 0%, #111827 100%); transition: all 0.3s ease; } .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(31, 41, 55, 0.3); } .results-card { background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%); border: 1px solid #e5e7eb; animation: slideUp 0.5s ease-out; } @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } } .metric-card { background: white; transition: transform 0.3s ease; } .metric-card:hover { transform: scale(1.02); } .word-counter { font-weight: 600; } .structure-guide { background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border: 1px solid #93c5fd; } .paragraph-counter { font-weight: 600; }</style></head><body class="min-h-screen py-8"><div class="container mx-auto px-4 max-w-4xl"><div class="text-center mb-10"><h1 class="text-4xl font-bold text-white mb-4 drop-shadow-lg">ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„ÙƒØªØ§Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</h1><p class="text-white/90 text-lg">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‡Ø§Ø±Ø© Ø§Ù„ØªÙŠ Ø´ÙØ±Ø­Øª ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© ÙˆØ§ÙƒØªØ¨ Ø¹Ù†...</p></div><div class="structure-guide rounded-2xl p-6 mb-8 text-gray-800"><h2 class="text-2xl font-bold mb-4 flex items-center">Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ø§Ù„ÙƒØªØ§Ø¨Ø©</h2><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div><h3 class="font-semibold text-lg mb-2">Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</h3><ul class="text-sm space-y-1"><li>â€¢ Ø¹Ù†ÙˆØ§Ù† Ø¬Ø°Ø§Ø¨ ÙˆÙ…Ù†Ø§Ø³Ø¨ Ù„Ù„Ù…Ø­ØªÙˆÙ‰</li><li>â€¢ ÙŠØ¹Ø¨Ø± Ø¹Ù† Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ Ø¨ÙˆØ¶ÙˆØ­</li><li>â€¢ ÙŠØ«ÙŠØ± Ø§Ù‡ØªÙ…Ø§Ù… Ø§Ù„Ù‚Ø§Ø±Ø¦</li></ul></div><div><h3 class="font-semibold text-lg mb-2">Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</h3><ul class="text-sm space-y-1"><li>â€¢ <strong>Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©:</strong> ØªÙ…Ù‡ÙŠØ¯ ÙˆØªØ¹Ø±ÙŠÙ Ø¨Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</li><li>â€¢ <strong>Ø§Ù„Ø¹Ø±Ø¶:</strong> ØªØ·ÙˆÙŠØ± Ø§Ù„Ø£ÙÙƒØ§Ø± ÙˆØ§Ù„ØªÙØ§ØµÙŠÙ„</li><li>â€¢ <strong>Ø§Ù„Ø®Ø§ØªÙ…Ø©:</strong> ØªÙ„Ø®ÙŠØµ ÙˆØ§Ø³ØªÙ†ØªØ§Ø¬</li></ul></div></div></div><div class="form-container rounded-2xl p-8 mb-8"><form id="submissionForm" class="space-y-8"><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div><label for="studentId" class="block text-lg font-semibold text-gray-800 mb-3">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØ§Ù„Ø´Ø¹Ø¨Ø© ÙˆØ§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ</label><input type="text" id="studentId" name="student_id" required placeholder="Ø³Ù„Ø·Ø§Ù† Ø§Ù„Ù…Ø¬ÙŠÙˆÙ„ 12353 447123456" class="input-field w-full px-4 py-3 rounded-xl text-lg focus:outline-none focus:ring-2 focus:ring-gray-300" /></div><div><label for="weeklyTopic" class="block text-lg font-semibold text-gray-800 mb-3">Ù…Ù‡Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</label><select id="weeklyTopic" name="weekly_topic" required class="input-field w-full px-4 py-3 rounded-xl text-lg focus:outline-none focus:ring-2 focus:ring-gray-300"><option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‡Ø§Ø±Ø©</option><option value="Ù‡Ù…Ø²Ø© Ø§Ù„ÙˆØµÙ„ ÙˆØ§Ù„Ù‚Ø·Ø¹">Ù‡Ù…Ø²Ø© Ø§Ù„ÙˆØµÙ„ ÙˆØ§Ù„Ù‚Ø·Ø¹</option><option value="Ø§Ù„Ù‡Ù…Ø²Ø§Øª: ÙˆØ³Ø· Ø§Ù„ÙƒÙ„Ù…Ø© ÙˆØ¢Ø®Ø±Ù‡Ø§">Ø§Ù„Ù‡Ù…Ø²Ø§Øª: ÙˆØ³Ø· Ø§Ù„ÙƒÙ„Ù…Ø© ÙˆØ¢Ø®Ø±Ù‡Ø§</option><option value="ØªØ·ÙˆÙŠØ± Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø¨ØµÙŠØ§ØºØ© Ø¹Ù†ÙˆØ§Ù† Ø¬Ø°Ø§Ø¨">ØªØ·ÙˆÙŠØ± Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø¨ØµÙŠØ§ØºØ© Ø¹Ù†ÙˆØ§Ù† Ø¬Ø°Ø§Ø¨</option><option value="ØµÙŠØ§ØºØ© Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ù‚Ø¯Ù…Ø©">ØµÙŠØ§ØºØ© Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ù‚Ø¯Ù…Ø©</option><option value="Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªÙƒØ«ÙŠÙ Ø§Ù„Ù…Ø¹Ø¬Ù…ÙŠ">Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªÙƒØ«ÙŠÙ Ø§Ù„Ù…Ø¹Ø¬Ù…ÙŠ</option><option value="Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªÙƒØ«ÙŠÙ Ø§Ù„ØªØ±ÙƒÙŠØ¨ÙŠ">Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªÙƒØ«ÙŠÙ Ø§Ù„ØªØ±ÙƒÙŠØ¨ÙŠ</option><option value="ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ø¥Ù‚Ù†Ø§Ø¹ÙŠ">ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ø¥Ù‚Ù†Ø§Ø¹ÙŠ</option><option value="ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ØµØ·Ù„Ø­Ø§Øª">ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ØµØ·Ù„Ø­Ø§Øª</option><option value="ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: ØªÙ‚Ø±ÙŠØ±">ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: ØªÙ‚Ø±ÙŠØ±</option><option value="ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: Ø®Ø·Ø§Ø¨ Ø¥Ø¯Ø§Ø±ÙŠ">ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: Ø®Ø·Ø§Ø¨ Ø¥Ø¯Ø§Ø±ÙŠ</option><option value="ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</option><option value="ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ">ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ</option><option value="ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: ÙƒØªØ§Ø¨Ø© Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©">ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: ÙƒØªØ§Ø¨Ø© Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©</option><option value="ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: ÙƒØªØ§Ø¨Ø© Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©">ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: ÙƒØªØ§Ø¨Ø© Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©</option></select></div></div><div><label for="title" class="block text-lg font-semibold text-gray-800 mb-3">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‚Ø§Ù„</label><input type="text" id="title" name="title" required placeholder="Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù†Ø§Ù‹ Ø¬Ø°Ø§Ø¨Ø§Ù‹ ÙˆÙ…Ø¹Ø¨Ø±Ø§Ù‹ Ø¹Ù† Ù…ÙˆØ¶ÙˆØ¹ Ù…Ù‚Ø§Ù„Ùƒ" class="input-field w-full px-4 py-3 rounded-xl text-lg focus:outline-none focus:ring-2 focus:ring-gray-300" minlength="5" maxlength="100" /><div class="mt-2 text-sm text-gray-600">ØªÙ†Ø¨ÙŠÙ‡: Ø§Ø¬Ø¹Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ø¶Ø­Ø§Ù‹ ÙˆØ¬Ø°Ø§Ø¨Ø§Ù‹ ÙˆÙŠØ¹Ø¨Ø± Ø¹Ù† Ù…Ø­ØªÙˆÙ‰ Ù…Ù‚Ø§Ù„Ùƒ</div></div><div><label for="article" class="block text-lg font-semibold text-gray-800 mb-3">Ù†Øµ Ø§Ù„Ù…Ù‚Ø§Ù„ (150-200 ÙƒÙ„Ù…Ø© - 3 ÙÙ‚Ø±Ø§Øª Ù…Ø·Ù„ÙˆØ¨Ø©)</label><div class="relative"><textarea id="article" name="article" rows="18" required placeholder="Ø§ÙƒØªØ¨ Ù…Ù‚Ø§Ù„Ùƒ Ù‡Ù†Ø§ Ù…Ù‚Ø³Ù…Ø§Ù‹ Ø¥Ù„Ù‰ Ø«Ù„Ø§Ø« ÙÙ‚Ø±Ø§Øª: Ø§Ù„ÙÙ‚Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ - Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©: ØªÙ…Ù‡ÙŠØ¯ Ù„Ù„Ù…ÙˆØ¶ÙˆØ¹ ÙˆØªØ¹Ø±ÙŠÙ Ø¨Ù‡... Ø§Ù„ÙÙ‚Ø±Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© - Ø§Ù„Ø¹Ø±Ø¶: ØªØ·ÙˆÙŠØ± Ø§Ù„Ø£ÙÙƒØ§Ø± ÙˆØ§Ù„ØªÙØ§ØµÙŠÙ„... Ø§Ù„ÙÙ‚Ø±Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© - Ø§Ù„Ø®Ø§ØªÙ…Ø©: ØªÙ„Ø®ÙŠØµ ÙˆØ§Ø³ØªÙ†ØªØ§Ø¬..." class="input-field w-full px-4 py-4 rounded-xl text-lg leading-relaxed resize-y min-h-[400px] focus:outline-none focus:ring-2 focus:ring-gray-300"></textarea><div class="absolute bottom-4 left-4 space-y-2"><div class="bg-gray-100 px-3 py-1 rounded-full"><span class="text-sm">Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©: </span><span id="wordCount" class="word-counter text-sm">0</span></div><div class="bg-blue-100 px-3 py-1 rounded-full"><span class="text-sm">Ø¹Ø¯Ø¯ Ø§Ù„ÙÙ‚Ø±Ø§Øª: </span><span id="paragraphCount" class="paragraph-counter text-sm">0</span></div></div></div><div class="mt-3 text-sm text-gray-600"><strong>ØªØ°ÙƒÙŠØ±:</strong> ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø§Ù„Ù…Ù‚Ø§Ù„ Ø¹Ù„Ù‰ Ø«Ù„Ø§Ø« ÙÙ‚Ø±Ø§Øª Ù…Ù†ÙØµÙ„Ø©: Ù…Ù‚Ø¯Ù…Ø© ÙˆØ¹Ø±Ø¶ ÙˆØ®Ø§ØªÙ…Ø©</div></div><div class="text-center"><button type="submit" id="submitBtn" class="btn-primary text-white py-4 px-12 rounded-xl text-xl font-semibold shadow-lg focus:outline-none focus:ring-4 focus:ring-gray-300">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù‚Ø§Ù„ Ù„Ù„ØªÙ‚ÙŠÙŠÙ…</button></div></form><div id="statusMessage" class="mt-8 p-6 rounded-xl hidden"><div id="statusText" class="text-center font-semibold text-lg"></div></div></div><div id="resultsContainer" class="hidden"><div class="results-card rounded-2xl p-8 text-gray-800"><h2 class="text-3xl font-bold text-center mb-8 text-gray-800">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h2><div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8"><div class="metric-card p-6 rounded-xl text-center shadow-lg"><div class="text-2xl mb-2">ğŸ“Š</div><div class="text-sm text-gray-600 mb-2">Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ø§Ù…</div><div id="rating" class="text-3xl font-bold text-gray-700">-/10</div></div><div class="metric-card p-6 rounded-xl text-center shadow-lg"><div class="text-2xl mb-2">ğŸ“Š</div><div class="text-sm text-gray-600 mb-2">Ø§Ù„ØªÙ†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø¬Ù…ÙŠ</div><div id="lexicalDiversity" class="text-3xl font-bold text-gray-700">-%</div></div><div class="metric-card p-6 rounded-xl text-center shadow-lg"><div class="text-2xl mb-2">ğŸ“ˆ</div><div class="text-sm text-gray-600 mb-2">Ø§Ù„ÙƒØ«Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø¬Ù…ÙŠØ©</div><div id="lexicalDensity" class="text-3xl font-bold text-gray-700">-%</div></div><div class="metric-card p-6 rounded-xl text-center shadow-lg"><div class="text-2xl mb-2">ğŸ“ˆ</div><div class="text-sm text-gray-600 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„ÙÙ‚Ø±Ø§Øª</div><div id="structureCount" class="text-3xl font-bold text-gray-700">-</div></div></div><div class="bg-gray-100 rounded-xl p-6 mb-6 border border-gray-200"><h3 class="text-xl font-bold mb-4 flex items-center text-gray-800">Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h3><p id="summary" class="text-gray-700 text-lg leading-relaxed"></p></div><div class="bg-gray-100 rounded-xl p-6 border border-gray-200"><h3 class="text-xl font-bold mb-4 flex items-center text-gray-800">Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØªÙØµÙŠÙ„ÙŠ ÙˆØ§Ù„Ù†ØµØ§Ø¦Ø­</h3><div id="detailedFeedback" class="text-gray-700 leading-relaxed whitespace-pre-wrap"></div></div><div class="text-center mt-6"><button id="downloadBtn" onclick="downloadSingleFile()" class="bg-black text-white px-8 py-3 rounded-xl hover:bg-gray-800 transition-colors font-semibold text-lg">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„ ÙˆØ§Ù„ØªÙ‚Ø±ÙŠØ±</button></div></div></div></div><script>const form = document.getElementById('submissionForm'); const titleInput = document.getElementById('title'); const articleTextarea = document.getElementById('article'); const wordCountSpan = document.getElementById('wordCount'); const paragraphCountSpan = document.getElementById('paragraphCount'); const submitBtn = document.getElementById('submitBtn'); const statusMessage = document.getElementById('statusMessage'); const statusText = document.getElementById('statusText'); const resultsContainer = document.getElementById('resultsContainer'); const downloadBtn = document.getElementById('downloadBtn'); const WEBHOOK_URL = 'https://n8n-production-salm.up.railway.app/webhook/specialized-writing'; let currentSubmissionData = null; let currentResultData = null; let docxLibraryLoaded = false; function countArabicWords(text) { if (!text || typeof text !== 'string') return 0; const words = text.trim().split(/\s+/).filter(word => { const cleanWord = word.replace(/[.,!?;:()""''Â«Â»\-\u060C\u061B\u061F]/g, ''); return cleanWord.length > 0 && /[\u0600-\u06FF]/.test(cleanWord); }); return words.length; } function countParagraphs(text) { if (!text || typeof text !== 'string') return 0; const paragraphs = text.split(/\n/).map(p => p.trim()).filter(p => p.length > 20); return paragraphs.length; } function updateCounts() { const text = articleTextarea.value.trim(); const arabicWords = countArabicWords(text); const paragraphs = countParagraphs(text); wordCountSpan.textContent = arabicWords; paragraphCountSpan.textContent = paragraphs; if (arabicWords < 150) { wordCountSpan.className = 'word-counter text-sm text-amber-600'; wordCountSpan.parentElement.className = 'bg-amber-50 px-3 py-1 rounded-full border border-amber-200'; } else if (arabicWords > 200) { wordCountSpan.className = 'word-counter text-sm text-red-600'; wordCountSpan.parentElement.className = 'bg-red-50 px-3 py-1 rounded-full border border-red-200'; } else { wordCountSpan.className = 'word-counter text-sm text-green-600'; wordCountSpan.parentElement.className = 'bg-green-50 px-3 py-1 rounded-full border border-green-200'; } if (paragraphs < 3) { paragraphCountSpan.className = 'paragraph-counter text-sm text-red-600'; paragraphCountSpan.parentElement.className = 'bg-red-50 px-3 py-1 rounded-full border border-red-200'; } else if (paragraphs === 3) { paragraphCountSpan.className = 'paragraph-counter text-sm text-green-600'; paragraphCountSpan.parentElement.className = 'bg-green-50 px-3 py-1 rounded-full border border-green-200'; } else { paragraphCountSpan.className = 'paragraph-counter text-sm text-blue-600'; paragraphCountSpan.parentElement.className = 'bg-blue-50 px-3 py-1 rounded-full border border-blue-200'; } } articleTextarea.addEventListener('input', updateCounts); async function loadDocxLibrary() { if (docxLibraryLoaded && typeof docx !== 'undefined') { return Promise.resolve(); } return new Promise((resolve, reject) => { const script = document.createElement('script'); script.src = 'https://cdn.jsdelivr.net/npm/docx@7.8.2/build/index.js'; script.onload = () => { docxLibraryLoaded = true; resolve(); }; script.onerror = () => reject(new Error('Failed to load docx library')); document.head.appendChild(script); }); } async function createEnhancedDocx() { const { Document, Packer } = docx; try { function createArabicParagraph(text, isBold = false, isHeader = false, isBullet = false) { const cleanedText = text.replace(/[:.]/g, '').trim(); const spacing = isHeader ? { after: 120 } : (isBullet ? { after: 80 } : { after: 100 }); const indent = isBullet ? { left: 400 } : {}; return new docx.Paragraph({ children: [ new docx.TextRun({ text: cleanedText, bold: isBold || isHeader, font: { name: "Arial" }, size: isHeader ? 24 : 22, rightToLeft: true }) ], alignment: docx.AlignmentType.BOTH, spacing: spacing, indent: indent, bidirectional: true }); } function processBulletText(text) { return text.replace(/^\*+\s*/, 'â€¢ ').trim(); } const studentInfo = currentSubmissionData.student_id; const topicInfo = currentSubmissionData.weekly_topic; const essayTitle = currentSubmissionData.title; const essayContent = currentSubmissionData.article; const feedbackText = currentResultData.gemini_feedback || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'; const summaryText = currentResultData.feedback_summary || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'; const feedbackLines = feedbackText.split('\n').filter(line => line.trim()); const summaryLines = summaryText.split('\n').filter(line => line.trim()); const children = [ createArabicParagraph("Ø§Ù„Ù…Ù‚Ø§Ù„ ÙˆØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…", true, true), createArabicParagraph(`Ø§Ù„Ø·Ø§Ù„Ø¨ ${studentInfo.replace(/[:.]/g, '').trim()}`), createArabicParagraph(`Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ ${topicInfo.replace(/[:.]/g, '').trim()}`), new docx.Paragraph({ children: [], spacing: { after: 400 } }), createArabicParagraph("Ø§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„Ø£ØµÙ„ÙŠ", true, true), createArabicParagraph(essayTitle, true), createArabicParagraph(essayContent), new docx.Paragraph({ children: [], spacing: { after: 400 } }), createArabicParagraph("ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…", true, true), createArabicParagraph(`Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ø§Ù… ${currentResultData.gemini_rating}/10`), createArabicParagraph(`Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª ${currentResultData.word_count} | Ø¹Ø¯Ø¯ Ø§Ù„ÙÙ‚Ø±Ø§Øª ${currentResultData.paragraph_count}`), createArabicParagraph(`Ø§Ù„ØªÙ†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø¬Ù…ÙŠ ${parseFloat(currentResultData.lexical_diversity).toFixed(1)}% | Ø§Ù„ÙƒØ«Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø¬Ù…ÙŠØ© ${parseFloat(currentResultData.lexical_density).toFixed(1)}%`), createArabicParagraph("Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…", true, true) ]; summaryLines.forEach(line => { if (line.trim()) { if (line.startsWith('*') || line.startsWith('-')) { children.push(createArabicParagraph(processBulletText(line), false, false, true)); } else if (line.includes(':') || line.length < 50) { children.push(createArabicParagraph(line, true)); } else { children.push(createArabicParagraph(line)); } } }); children.push(createArabicParagraph("Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØªÙØµÙŠÙ„ÙŠ", true, true)); feedbackLines.forEach(line => { if (line.trim()) { if (line.startsWith('*') || line.startsWith('-')) { children.push(createArabicParagraph(processBulletText(line), false, false, true)); } else if (line.includes(':') || line.length < 50) { children.push(createArabicParagraph(line, true)); } else { children.push(createArabicParagraph(line)); } } }); const doc = new Document({ sections: [{ properties: { page: { margin: { top: 720, right: 720, bottom: 720, left: 720 } } }, children: children }], styles: { default: { document: { run: { font: "Arial", size: 22, rightToLeft: true }, paragraph: { alignment: docx.AlignmentType.RIGHT, bidirectional: true } } } } }); const blob = await Packer.toBlob(doc); downloadFile(blob, 'Ø§Ù„Ù…Ù‚Ø§Ù„_ÙˆØ§Ù„ØªÙ‚Ø±ÙŠØ±.docx', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'); } catch (error) { console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙ†Ø¯:', error); alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙ†Ø¯. Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ù†ØµÙŠ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø°Ù„Ùƒ.'); createTextFile(); } } async function downloadSingleFile() { if (!currentSubmissionData || !currentResultData) { alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØ­Ù…ÙŠÙ„. ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù‚Ø§Ù„ Ø£ÙˆÙ„Ø§Ù‹.'); return; } downloadBtn.disabled = true; downloadBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...'; try { await loadDocxLibrary(); await createEnhancedDocx(); } catch (error) { console.error('Error creating document:', error); createTextFile(); } finally { downloadBtn.disabled = false; downloadBtn.textContent = 'ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„ ÙˆØ§Ù„ØªÙ‚Ø±ÙŠØ±'; } } function createTextFile() { const content = `Ø§Ù„Ù…Ù‚Ø§Ù„ ÙˆØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…\n\nØ§Ù„Ø·Ø§Ù„Ø¨: ${currentSubmissionData.student_id}\nØ§Ù„Ù…ÙˆØ¶ÙˆØ¹: ${currentSubmissionData.weekly_topic}\nØ§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleDateString('ar-SA')}\n\n================================\n\nØ§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„Ø£ØµÙ„ÙŠ\n\nØ§Ù„Ø¹Ù†ÙˆØ§Ù†: ${currentSubmissionData.title}\n\n${currentSubmissionData.article}\n\n================================\n\nØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…\n\nØ§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ø§Ù…: ${currentResultData.gemini_rating}/10\nØ¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª: ${currentResultData.word_count}\nØ¹Ø¯Ø¯ Ø§Ù„ÙÙ‚Ø±Ø§Øª: ${currentResultData.paragraph_count}\nØ§Ù„ØªÙ†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø¬Ù…ÙŠ: ${currentResultData.lexical_diversity}%\nØ§Ù„ÙƒØ«Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø¬Ù…ÙŠØ©: ${currentResultData.lexical_density}%\n\nÙ…Ù„Ø®Øµ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:\n${currentResultData.feedback_summary || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}\n\nØ§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØªÙØµÙŠÙ„ÙŠ:\n${currentResultData.gemini_feedback || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}\n\n================================\nØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¢Ù„ÙŠ`; const blob = new Blob([content], { type: 'text/plain;charset=utf-8' }); downloadFile(blob, 'Ø§Ù„Ù…Ù‚Ø§Ù„_ÙˆØ§Ù„ØªÙ‚Ø±ÙŠØ±.txt', 'text/plain'); } function downloadFile(blob, filename, mimeType) { const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = filename; a.style.display = 'none'; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url); } form.addEventListener('submit', async function(e) { e.preventDefault(); const formData = new FormData(form); const studentId = formData.get('student_id'); const weeklyTopic = formData.get('weekly_topic'); const title = formData.get('title'); const article = formData.get('article'); const studentIdParts = studentId.trim().split(/\s+/); if (studentIdParts.length < 3) { showStatus('ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø´Ø¹Ø¨Ø© ÙˆØ§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ ÙƒØ§Ù…Ù„Ø© (Ù…Ø«Ø§Ù„ Ø³Ù„Ø·Ø§Ù† Ø§Ù„Ù…Ø¬ÙŠÙˆÙ„ 12353 447123456)', 'error'); return; } if (!title.trim() || title.trim().length < 5) { showStatus('ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ù„Ù„Ù…Ù‚Ø§Ù„ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰: 5 Ø£Ø­Ø±Ù)', 'error'); titleInput.focus(); return; } const arabicWordCount = countArabicWords(article); const paragraphCount = countParagraphs(article); if (arabicWordCount < 150) { showStatus(`Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù‚Ø§Ù„. ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ${arabicWordCount} ÙƒÙ„Ù…Ø© Ø¹Ø±Ø¨ÙŠØ© ÙÙ‚Ø·. Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: 150 ÙƒÙ„Ù…Ø© Ø¹Ø±Ø¨ÙŠØ©.`, 'error'); articleTextarea.focus(); return; } if (paragraphCount < 3) { showStatus(`ØªØ­Ø°ÙŠØ±: Ø§Ù„Ù…Ù‚Ø§Ù„ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ${paragraphCount} ÙÙ‚Ø±Ø§Øª ÙÙ‚Ø·. ÙŠÙÙ†ØµØ­ Ø¨ÙˆØ¬ÙˆØ¯ 3 ÙÙ‚Ø±Ø§Øª (Ù…Ù‚Ø¯Ù…Ø©ØŒ Ø¹Ø±Ø¶ØŒ Ø®Ø§ØªÙ…Ø©). Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ`, 'warning'); if (!confirm('Ø§Ù„Ù…Ù‚Ø§Ù„ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 3 ÙÙ‚Ø±Ø§Øª Ù…Ù†ÙØµÙ„Ø©. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„Ù‡ Ù„Ù„ØªÙ‚ÙŠÙŠÙ… Ø±ØºÙ… Ø°Ù„ÙƒØŸ')) { articleTextarea.focus(); return; } } currentSubmissionData = { student_id: studentId, weekly_topic: weeklyTopic, title: title, article: article }; showStatus('ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù‚Ø§Ù„ ÙˆØ§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…...', 'loading'); submitBtn.disabled = true; submitBtn.innerHTML = 'ØªØ­Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…...'; resultsContainer.classList.add('hidden'); const data = { student_id: studentId, weekly_topic: weeklyTopic, title: title, article: article }; try { const response = await fetch(WEBHOOK_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) }); if (!response.ok) { throw new Error(`HTTP error! status: ${response.status}`); } const result = await response.json(); currentResultData = result; showStatus('ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­! Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø£Ø¯Ù†Ø§Ù‡', 'success'); displayResults(result); } catch (error) { console.error('Error:', error); showStatus('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù‚Ø§Ù„. ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'error'); } finally { submitBtn.disabled = false; submitBtn.innerHTML = 'Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù‚Ø§Ù„ Ù„Ù„ØªÙ‚ÙŠÙŠÙ…'; } }); function showStatus(message, type) { statusText.textContent = message; let bgColor, textColor; switch(type) { case 'success': bgColor = 'bg-green-100 border border-green-300'; textColor = 'text-green-800'; break; case 'error': bgColor = 'bg-red-100 border border-red-300'; textColor = 'text-red-800'; break; case 'warning': bgColor = 'bg-yellow-100 border border-yellow-300'; textColor = 'text-yellow-800'; break; case 'loading': bgColor = 'bg-gray-100 border border-gray-300'; textColor = 'text-gray-800'; break; } statusMessage.className = `mt-8 p-6 rounded-xl ${bgColor}`; statusText.className = `text-center font-semibold text-lg ${textColor}`; statusMessage.classList.remove('hidden'); } function formatFeedbackText(text) { if (!text) return 'Ø´ÙƒØ±Ø§Ù‹ Ù„Ø¥Ø±Ø³Ø§Ù„ Ù…Ù‚Ø§Ù„Ùƒ. Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡ Ù‚Ø±ÙŠØ¨Ø§Ù‹.'; let formatted = text .replace(/- /g, 'â€¢ ') .replace(/\* /g, 'â€¢ ') .replace(/^(Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:[^\n]*)/gm, '<div class="font-bold text-lg mb-3 text-gray-800">$1</div>') .replace(/^(Ø§Ù„Ù…Ù„Ø®Øµ:[^\n]*)/gm, '<div class="font-bold text-lg mb-3 text-gray-800">$1</div>') .replace(/^(ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:[^\n]*)/gm, '<div class="font-semibold text-base mb-2 text-blue-700">$1</div>') .replace(/^(ØªÙ‚ÙŠÙŠÙ… Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„:[^\n]*)/gm, '<div class="font-semibold text-base mb-2 text-green-700">$1</div>') .replace(/^(Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø¥Ù…Ù„Ø§Ø¦ÙŠØ©:[^\n]*)/gm, '<div class="font-semibold text-base mb-2 text-red-700">$1</div>') .replace(/^(Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù†Ø­ÙˆÙŠØ©:[^\n]*)/gm, '<div class="font-semibold text-base mb-2 text-red-700">$1</div>') .replace(/^(Ù†ØµØ§Ø¦Ø­ Ù„Ù„ØªØ­Ø³ÙŠÙ†:[^\n]*)/gm, '<div class="font-semibold text-base mb-2 text-blue-700">$1</div>') .replace(/^â€¢ ([^\n]+)/gm, '<div class="mr-4 mb-2">â€¢ $1</div>') .replace(/\n\n/g, '</p><p class="mb-4">') .replace(/^/, '<p class="mb-4">') .replace(/$/, '</p>'); return formatted; } function displayResults(data) { console.log('Received data:', data); document.getElementById('rating').textContent = data.gemini_rating ? `${data.gemini_rating}/10` : 'ØºÙŠØ± Ù…ØªÙˆÙØ±'; document.getElementById('lexicalDiversity').textContent = data.lexical_diversity ? `${parseFloat(data.lexical_diversity).toFixed(1)}%` : 'ØºÙŠØ± Ù…ØªÙˆÙØ±'; document.getElementById('lexicalDensity').textContent = data.lexical_density ? `${parseFloat(data.lexical_density).toFixed(1)}%` : 'ØºÙŠØ± Ù…ØªÙˆÙØ±'; document.getElementById('structureCount').textContent = data.paragraph_count ? data.paragraph_count : 'ØºÙŠØ± Ù…ØªÙˆÙØ±'; let summary = 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ù‚Ø§Ù„ ÙˆØ³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡'; if (data.feedback_summary && typeof data.feedback_summary === 'string') { summary = data.feedback_summary; } document.getElementById('summary').textContent = summary; let feedback = 'Ø´ÙƒØ±Ø§Ù‹ Ù„Ø¥Ø±Ø³Ø§Ù„ Ù…Ù‚Ø§Ù„Ùƒ. Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡ Ù‚Ø±ÙŠØ¨Ø§Ù‹.'; if (data.gemini_feedback && typeof data.gemini_feedback === 'string') { feedback = data.gemini_feedback; } const formattedFeedback = formatFeedbackText(feedback); document.getElementById('detailedFeedback').innerHTML = formattedFeedback; resultsContainer.classList.remove('hidden'); setTimeout(() => { resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' }); }, 300); } updateCounts();</script></body></html>
