<!DOCTYPE html><html lang=ar dir=rtl><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Ø§Ù„ÙƒØªØ§Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</title><script>console.warn=function(){};</script><script src=https://cdn.tailwindcss.com></script><style>@import url(https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap);body{font-family:Cairo,sans-serif;direction:rtl;background:#000;min-height:100vh;padding:10px}.container{max-width:800px;margin:0 auto}.form-container{background:rgba(255,255,255,.95);backdrop-filter:blur(10px);box-shadow:0 20px 40px rgba(0,0,0,.1);border-radius:16px;padding:24px 16px}.input-field{transition:all .3s ease;border:2px solid #e2e8f0;font-size:15px;padding:10px 12px}.input-field:focus{border-color:#6b7280;box-shadow:0 0 0 3px rgba(107,114,128,.1);transform:translateY(-1px)}.btn-primary{background:linear-gradient(135deg,#1f2937 0%,#111827 100%);transition:all .3s ease;padding:12px 24px;font-size:1rem}.btn-primary:hover{transform:translateY(-2px);box-shadow:0 10px 20px rgba(31,41,55,.3)}.results-card{background:linear-gradient(135deg,#f9fafb 0%,#f3f4f6 100%);border:1px solid #e5e7eb;animation:slideUp .5s ease-out;border-radius:16px;padding:20px}@keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.metric-card{background:#fff;transition:transform .3s ease;padding:12px;border-radius:8px}.metric-card:hover{transform:scale(1.02)}.word-counter{font-weight:600}.structure-guide{background:linear-gradient(135deg,#eff6ff 0%,#dbeafe 100%);border:1px solid #93c5fd;border-radius:16px}.paragraph-counter{font-weight:600}.section-card{background:#fff;border-radius:10px;padding:16px;margin-bottom:16px;border-right:4px solid #667eea}.section-card.summary{background:#eff6ff;border-right-color:#3b82f6}.section-card.priority-errors{background:#fff5f5;border-right-color:#dc3545}.section-card.other-errors{background:#fff5f5;border-right-color:#dc3545}.section-card.analysis{background:#f0f9ff;border-right-color:#0ea5e9}.section-card.tips{background:#f0fdf4;border-right-color:#16a34a}.section-title{font-size:1.1rem;font-weight:700;margin-bottom:12px;display:flex;align-items:center;gap:8px;color:#1f2937}.section-title.priority{color:#dc3545}.section-title.analysis-title{color:#0ea5e9}.section-title.tips-title{color:#16a34a}.section-content{line-height:1.7;color:#374151;font-size:.95rem;text-align:justify}.error-box{background:#fff;border:1px solid #fecaca;border-radius:8px;padding:12px;margin-bottom:10px;text-align:justify}.error-box:last-child{margin-bottom:0}.error-highlight{color:#dc3545;font-weight:700;background:#fff5f5;padding:2px 5px;border-radius:3px}.numbered-item{display:flex;align-items:flex-start;gap:10px;margin-bottom:10px;padding:10px;background:#fff;border-radius:8px}.numbered-item:last-child{margin-bottom:0}.number-badge{background:#3b82f6;color:#fff;width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.8rem;font-weight:700;flex-shrink:0}.number-badge.tip{background:#16a34a}.item-text{flex:1;color:#374151;font-size:.9rem;line-height:1.6;text-align:justify}</style></head><body class="min-h-screen py-8"><div class="container mx-auto px-4 max-w-4xl"><div class="text-center mb-8"><h1 class="text-3xl font-bold text-white mb-3 drop-shadow-lg">ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„ÙƒØªØ§Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</h1><p class="text-white/90 text-base">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‡Ø§Ø±Ø© Ø§Ù„ØªÙŠ Ø´ÙØ±Ø­Øª ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© ÙˆØ§ÙƒØªØ¨ Ø¹Ù†...</p></div><div class="structure-guide rounded-2xl p-5 mb-6 text-gray-800"><h2 class="text-xl font-bold mb-3 flex items-center">Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ø§Ù„ÙƒØªØ§Ø¨Ø©</h2><div class="grid grid-cols-1 md:grid-cols-2 gap-5"><div><h3 class="font-semibold text-base mb-2">Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</h3><ul class="text-sm space-y-1"><li>â€¢ Ø¹Ù†ÙˆØ§Ù† Ø¬Ø°Ø§Ø¨ ÙˆÙ…Ù†Ø§Ø³Ø¨ Ù„Ù„Ù…Ø­ØªÙˆÙ‰</li><li>â€¢ ÙŠØ¹Ø¨Ø± Ø¹Ù† Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ Ø¨ÙˆØ¶ÙˆØ­</li><li>â€¢ ÙŠØ«ÙŠØ± Ø§Ù‡ØªÙ…Ø§Ù… Ø§Ù„Ù‚Ø§Ø±Ø¦</li></ul></div><div><h3 class="font-semibold text-base mb-2">Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</h3><ul class="text-sm space-y-1"><li>â€¢ <strong>Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©:</strong> ØªÙ…Ù‡ÙŠØ¯ ÙˆØªØ¹Ø±ÙŠÙ Ø¨Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</li><li>â€¢ <strong>Ø§Ù„Ø¹Ø±Ø¶:</strong> ØªØ·ÙˆÙŠØ± Ø§Ù„Ø£ÙÙƒØ§Ø± ÙˆØ§Ù„ØªÙØ§ØµÙŠÙ„</li><li>â€¢ <strong>Ø§Ù„Ø®Ø§ØªÙ…Ø©:</strong> ØªÙ„Ø®ÙŠØµ ÙˆØ§Ø³ØªÙ†ØªØ§Ø¬</li></ul></div></div></div><div class="form-container rounded-2xl p-6 mb-6"><form id=submissionForm class=space-y-6><div class="grid grid-cols-1 md:grid-cols-2 gap-5"><div><label for=studentId class="block text-base font-semibold text-gray-800 mb-2">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØ§Ù„Ø´Ø¹Ø¨Ø© ÙˆØ§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ</label><input type=text id=studentId name=student_id required placeholder="Ø³Ù„Ø·Ø§Ù† 1 447123456" class="input-field w-full rounded-xl focus:outline-none focus:ring-2 focus:ring-gray-300"></div><div><label for=weeklyTopic class="block text-base font-semibold text-gray-800 mb-2">Ù…Ù‡Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</label><select id=weeklyTopic name=weekly_topic required class="input-field w-full rounded-xl focus:outline-none focus:ring-2 focus:ring-gray-300"><option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‡Ø§Ø±Ø©</option><option value="Ù‡Ù…Ø²Ø© Ø§Ù„ÙˆØµÙ„ ÙˆØ§Ù„Ù‚Ø·Ø¹">Ù‡Ù…Ø²Ø© Ø§Ù„ÙˆØµÙ„ ÙˆØ§Ù„Ù‚Ø·Ø¹</option><option value="Ø§Ù„Ù‡Ù…Ø²Ø§Øª: ÙˆØ³Ø· Ø§Ù„ÙƒÙ„Ù…Ø© ÙˆØ¢Ø®Ø±Ù‡Ø§">Ø§Ù„Ù‡Ù…Ø²Ø§Øª: ÙˆØ³Ø· Ø§Ù„ÙƒÙ„Ù…Ø© ÙˆØ¢Ø®Ø±Ù‡Ø§</option><option value="ØªØ·ÙˆÙŠØ± Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø¨ØµÙŠØ§ØºØ© Ø¹Ù†ÙˆØ§Ù† Ø¬Ø°Ø§Ø¨">ØªØ·ÙˆÙŠØ± Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø¨ØµÙŠØ§ØºØ© Ø¹Ù†ÙˆØ§Ù† Ø¬Ø°Ø§Ø¨</option><option value="ØµÙŠØ§ØºØ© Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ù‚Ø¯Ù…Ø©">ØµÙŠØ§ØºØ© Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ù‚Ø¯Ù…Ø©</option><option value="Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªÙƒØ«ÙŠÙ Ø§Ù„Ù…Ø¹Ø¬Ù…ÙŠ">Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªÙƒØ«ÙŠÙ Ø§Ù„Ù…Ø¹Ø¬Ù…ÙŠ</option><option value="Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªÙƒØ«ÙŠÙ Ø§Ù„ØªØ±ÙƒÙŠØ¨ÙŠ">Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªÙƒØ«ÙŠÙ Ø§Ù„ØªØ±ÙƒÙŠØ¨ÙŠ</option><option value="ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ø¥Ù‚Ù†Ø§Ø¹ÙŠ">ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ø¥Ù‚Ù†Ø§Ø¹ÙŠ</option><option value="ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ØµØ·Ù„Ø­Ø§Øª">ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ØµØ·Ù„Ø­Ø§Øª</option><option value="ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: ØªÙ‚Ø±ÙŠØ±">ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: ØªÙ‚Ø±ÙŠØ±</option><option value="ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: Ø®Ø·Ø§Ø¨ Ø¥Ø¯Ø§Ø±ÙŠ">ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: Ø®Ø·Ø§Ø¨ Ø¥Ø¯Ø§Ø±ÙŠ</option><option value="ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</option><option value="ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ">ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ</option><option value="ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: ÙƒØªØ§Ø¨Ø© Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©">ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: ÙƒØªØ§Ø¨Ø© Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©</option><option value="ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: ÙƒØªØ§Ø¨Ø© Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©">ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ®ØµØµ: ÙƒØªØ§Ø¨Ø© Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©</option></select></div></div><div><label for=title class="block text-base font-semibold text-gray-800 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‚Ø§Ù„</label><input type=text id=title name=title required placeholder="Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù†Ø§Ù‹ Ø¬Ø°Ø§Ø¨Ø§Ù‹ ÙˆÙ…Ø¹Ø¨Ø±Ø§Ù‹ Ø¹Ù† Ù…ÙˆØ¶ÙˆØ¹ Ù…Ù‚Ø§Ù„Ùƒ" class="input-field w-full rounded-xl focus:outline-none focus:ring-2 focus:ring-gray-300" minlength=5 maxlength=100><div class="mt-2 text-xs text-gray-600">ØªÙ†Ø¨ÙŠÙ‡: Ø§Ø¬Ø¹Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ø¶Ø­Ø§Ù‹ ÙˆØ¬Ø°Ø§Ø¨Ø§Ù‹</div></div><div><label for=article class="block text-base font-semibold text-gray-800 mb-2">Ù†Øµ Ø§Ù„Ù…Ù‚Ø§Ù„ (150-200 ÙƒÙ„Ù…Ø© - 3 ÙÙ‚Ø±Ø§Øª)</label><div class=relative><textarea id=article name=article rows=15 required placeholder="Ø§ÙƒØªØ¨ Ù…Ù‚Ø§Ù„Ùƒ Ù‡Ù†Ø§..." class="input-field w-full rounded-xl leading-relaxed resize-y min-h-[300px] focus:outline-none focus:ring-2 focus:ring-gray-300"></textarea><div class="absolute bottom-3 left-3 space-y-2"><div class="bg-gray-100 px-3 py-1 rounded-full"><span class=text-xs>Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª: </span><span id=wordCount class="word-counter text-xs">0</span></div><div class="bg-blue-100 px-3 py-1 rounded-full"><span class=text-xs>Ø¹Ø¯Ø¯ Ø§Ù„ÙÙ‚Ø±Ø§Øª: </span><span id=paragraphCount class="paragraph-counter text-xs">0</span></div></div></div></div><div class=text-center><button type=submit id=submitBtn class="btn-primary text-white rounded-xl font-semibold shadow-lg focus:outline-none focus:ring-4 focus:ring-gray-300">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù‚Ø§Ù„ Ù„Ù„ØªÙ‚ÙŠÙŠÙ…</button></div></form><div id=statusMessage class="mt-6 p-5 rounded-xl hidden"><div id=statusText class="text-center font-semibold text-base"></div></div></div><div id=resultsContainer class=hidden><div class="results-card rounded-2xl p-6 text-gray-800"><h2 class="text-2xl font-bold text-center mb-6 text-gray-800">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h2><div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6"><div class="metric-card text-center shadow-lg"><div class="text-xl mb-1">ğŸ“Š</div><div class="text-xs text-gray-600 mb-1">Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ø§Ù…</div><div id=rating class="text-2xl font-bold text-gray-700">-/10</div></div><div class="metric-card text-center shadow-lg"><div class="text-xl mb-1">ğŸ“</div><div class="text-xs text-gray-600 mb-1">Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª</div><div id=wordCountMetric class="text-2xl font-bold text-gray-700">-</div></div><div class="metric-card text-center shadow-lg"><div class="text-xl mb-1">ğŸ“Š</div><div class="text-xs text-gray-600 mb-1">Ø§Ù„ØªÙ†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø¬Ù…ÙŠ</div><div id=lexicalDiversity class="text-2xl font-bold text-gray-700">-%</div></div><div class="metric-card text-center shadow-lg"><div class="text-xl mb-1">ğŸ“ˆ</div><div class="text-xs text-gray-600 mb-1">Ø§Ù„ÙƒØ«Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø¬Ù…ÙŠØ©</div><div id=lexicalDensity class="text-2xl font-bold text-gray-700">-%</div></div><div class="metric-card text-center shadow-lg"><div class="text-xl mb-1">ğŸ“„</div><div class="text-xs text-gray-600 mb-1">Ø¹Ø¯Ø¯ Ø§Ù„ÙÙ‚Ø±Ø§Øª</div><div id=structureCount class="text-2xl font-bold text-gray-700">-</div></div></div><div id=feedbackSections></div><div class="text-center mt-5"><button id=downloadBtn onclick=downloadSingleFile() class="bg-black text-white px-6 py-2 text-sm rounded-xl hover:bg-gray-800 transition-colors font-semibold">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„ ÙˆØ§Ù„ØªÙ‚Ø±ÙŠØ±</button></div></div></div></div><script>const form=document.getElementById("submissionForm"),titleInput=document.getElementById("title"),articleTextarea=document.getElementById("article"),wordCountSpan=document.getElementById("wordCount"),paragraphCountSpan=document.getElementById("paragraphCount"),submitBtn=document.getElementById("submitBtn"),statusMessage=document.getElementById("statusMessage"),statusText=document.getElementById("statusText"),resultsContainer=document.getElementById("resultsContainer"),downloadBtn=document.getElementById("downloadBtn"),WEBHOOK_URL="https://n8n-production-salm.up.railway.app/webhook/specialized-writing";let currentSubmissionData=null,currentResultData=null,docxLibraryLoaded=!1;function countArabicWords(a){if(!a||"string"!=typeof a)return 0;return a.trim().split(/\s+/).filter(b=>{let c=b.replace(/[.,!?;:()""''Â«Â»\-\u060C\u061B\u061F]/g,"");return c.length>0&&/[\u0600-\u06FF]/.test(c)}).length}function countParagraphs(a){if(!a||"string"!=typeof a)return 0;return a.split(/\n/).map(b=>b.trim()).filter(b=>b.length>20).length}function updateCounts(){let a=articleTextarea.value.trim(),b=countArabicWords(a),c=countParagraphs(a);wordCountSpan.textContent=b,paragraphCountSpan.textContent=c,b<150?(wordCountSpan.className="word-counter text-xs text-amber-600",wordCountSpan.parentElement.className="bg-amber-50 px-3 py-1 rounded-full border border-amber-200"):b>200?(wordCountSpan.className="word-counter text-xs text-red-600",wordCountSpan.parentElement.className="bg-red-50 px-3 py-1 rounded-full border border-red-200"):(wordCountSpan.className="word-counter text-xs text-green-600",wordCountSpan.parentElement.className="bg-green-50 px-3 py-1 rounded-full border border-green-200"),c<3?(paragraphCountSpan.className="paragraph-counter text-xs text-red-600",paragraphCountSpan.parentElement.className="bg-red-50 px-3 py-1 rounded-full border border-red-200"):3===c?(paragraphCountSpan.className="paragraph-counter text-xs text-green-600",paragraphCountSpan.parentElement.className="bg-green-50 px-3 py-1 rounded-full border border-green-200"):(paragraphCountSpan.className="paragraph-counter text-xs text-blue-600",paragraphCountSpan.parentElement.className="bg-blue-50 px-3 py-1 rounded-full border border-blue-200")}articleTextarea.addEventListener("input",updateCounts);async function loadDocxLibrary(){return docxLibraryLoaded&&"undefined"!=typeof docx?Promise.resolve():new Promise((a,b)=>{let c=document.createElement("script");c.src="https://cdn.jsdelivr.net/npm/docx@7.8.2/build/index.js",c.onload=()=>{docxLibraryLoaded=!0,a()},c.onerror=()=>b(new Error("Failed to load docx library")),document.head.appendChild(c)})}async function createEnhancedDocx(){let{Document:a,Packer:b}=docx;try{function c(k,l=!1,m=!1,n=!1,o=!1){let p=k.trim(),q=m?{after:120}:n||o?{after:80}:{after:100},r=n?{left:400}:o?{left:720}:{};return new docx.Paragraph({children:[new docx.TextRun({text:p,bold:m,font:{name:"Arial"},size:m?24:22,rightToLeft:!0})],alignment:docx.AlignmentType.BOTH,spacing:q,indent:r,bidirectional:!0})}function d(k){let l=k.trim();if(l.match(/^\d+\.?\s*Ø§Ù„Ø®Ø·Ø£/)){l=l.replace(/^(\d+)\.?\s*Ø§Ù„Ø®Ø·Ø£[:\s]*/,"$1 Ø§Ù„Ø®Ø·Ø£: ")}else if(l.match(/^\d+\.?\s+/)){l=l.replace(/^(\d+)\.?\s+/,"$1 ")}if(l.startsWith("â€¢")){return l}if(l.startsWith("*")){l=l.replace(/^\*+\s*/,"â€¢ ");return l}return l}let e=currentSubmissionData.student_id,f=currentSubmissionData.weekly_topic,g=currentSubmissionData.title,h=currentSubmissionData.article,i=currentResultData.gemini_feedback||"ØºÙŠØ± Ù…ØªÙˆÙØ±",j=currentResultData.feedback_summary||"ØºÙŠØ± Ù…ØªÙˆÙØ±",k=i.split("\n").filter(o=>o.trim()),l=j.split("\n").filter(o=>o.trim()),m=[c("Ø§Ù„Ù…Ù‚Ø§Ù„ ÙˆØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…",!0,!0),c(`Ø§Ù„Ø·Ø§Ù„Ø¨: ${e.replace(/[:.]/g,"").trim()}`),c(`Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹: ${f.replace(/[:.]/g,"").trim()}`),new docx.Paragraph({children:[],spacing:{after:400}}),c("Ø§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„Ø£ØµÙ„ÙŠ",!0,!0),c(g,!0),c(h),new docx.Paragraph({children:[],spacing:{after:400}}),c("ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…",!0,!0),c(`Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ø§Ù…: ${Math.round(parseFloat(currentResultData.lexical_density)/10)}/10`),c(`Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª: ${currentResultData.word_count} | Ø¹Ø¯Ø¯ Ø§Ù„ÙÙ‚Ø±Ø§Øª: ${currentResultData.paragraph_count}`),c(`Ø§Ù„ØªÙ†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø¬Ù…ÙŠ: ${(parseFloat(currentResultData.lexical_diversity)/10).toFixed(1)}% | Ø§Ù„ÙƒØ«Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø¬Ù…ÙŠØ©: ${(parseFloat(currentResultData.lexical_density)/10).toFixed(1)}%`),c("Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…",!0,!0)];l.forEach(o=>{o.trim()&&(o.startsWith("*")||o.startsWith("-")||o.startsWith("â€¢")?m.push(c(d(o),!1,!1,!1,!0)):o.includes(":")||o.length<50?m.push(c(o,!1)):m.push(c(o)))}),m.push(c("Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØªÙØµÙŠÙ„ÙŠ",!0,!0)),k.forEach(o=>{let p=o.trim();if(p.includes("ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ø±Ø© Ø§Ù„Ù„ØºÙˆÙŠØ©")){p=p.replace(/ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ø±Ø© Ø§Ù„Ù„ØºÙˆÙŠØ©.*$/,"ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡");m.push(c(p,!0));return}if(p.startsWith("*")||p.startsWith("-")||p.startsWith("â€¢")){m.push(c(d(p),!1,!1,!1,!0))}else if(p.includes(":")||p.length<50){m.push(c(p,!1))}else{m.push(c(p))}});let n=new a({sections:[{properties:{page:{margin:{top:720,right:720,bottom:720,left:720}}},children:m}],styles:{default:{document:{run:{font:"Arial",size:22,rightToLeft:!0},paragraph:{alignment:docx.AlignmentType.RIGHT,bidirectional:!0}}}}}),o=await b.toBlob(n);downloadFile(o,"Ø§Ù„Ù…Ù‚Ø§Ù„_ÙˆØ§Ù„ØªÙ‚Ø±ÙŠØ±.docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document")}catch(a){console.error("Ø­Ø¯Ø« Ø®Ø·Ø£:",a),alert("Ø­Ø¯Ø« Ø®Ø·Ø£. Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ù†ØµÙŠ."),createTextFile()}}async function downloadSingleFile(){currentSubmissionData&&currentResultData?(downloadBtn.disabled=!0,downloadBtn.textContent="Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...",await loadDocxLibrary().then(()=>createEnhancedDocx()).catch(a=>{console.error("Error:",a),createTextFile()}).finally(()=>{downloadBtn.disabled=!1,downloadBtn.textContent="ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„ ÙˆØ§Ù„ØªÙ‚Ø±ÙŠØ±"})):alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØ­Ù…ÙŠÙ„.")}function createTextFile(){let a=`Ø§Ù„Ù…Ù‚Ø§Ù„ ÙˆØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…\n\nØ§Ù„Ø·Ø§Ù„Ø¨: ${currentSubmissionData.student_id}\nØ§Ù„Ù…ÙˆØ¶ÙˆØ¹: ${currentSubmissionData.weekly_topic}\n\n================================\n\nØ§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„Ø£ØµÙ„ÙŠ\n\nØ§Ù„Ø¹Ù†ÙˆØ§Ù†: ${currentSubmissionData.title}\n\n${currentSubmissionData.article}\n\n================================\n\nØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…\n\nØ§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ø§Ù…: ${Math.round(parseFloat(currentResultData.lexical_density)/10)}/10\nØ¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª: ${currentResultData.word_count}\nØ¹Ø¯Ø¯ Ø§Ù„ÙÙ‚Ø±Ø§Øª: ${currentResultData.paragraph_count}\nØ§Ù„ØªÙ†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø¬Ù…ÙŠ: ${(currentResultData.lexical_diversity/10).toFixed(1)}%\nØ§Ù„ÙƒØ«Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø¬Ù…ÙŠØ©: ${(currentResultData.lexical_density/10).toFixed(1)}%\n\nÙ…Ù„Ø®Øµ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:\n${currentResultData.feedback_summary||"ØºÙŠØ± Ù…ØªÙˆÙØ±"}\n\nØ§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØªÙØµÙŠÙ„ÙŠ:\n${currentResultData.gemini_feedback||"ØºÙŠØ± Ù…ØªÙˆÙØ±"}`,b=new Blob([a],{type:"text/plain;charset=utf-8"});downloadFile(b,"Ø§Ù„Ù…Ù‚Ø§Ù„_ÙˆØ§Ù„ØªÙ‚Ø±ÙŠØ±.txt","text/plain")}function downloadFile(a,b,c){let d=URL.createObjectURL(a),e=document.createElement("a");e.href=d,e.download=b,e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(d)}form.addEventListener("submit",async function(a){a.preventDefault();let b=new FormData(form),c=b.get("student_id"),d=b.get("weekly_topic"),e=b.get("title"),f=b.get("article"),g=c.trim().split(/\s+/);if(g.length<3){showStatus("ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø´Ø¹Ø¨Ø© ÙˆØ§Ù„Ø±Ù‚Ù… ÙƒØ§Ù…Ù„Ø©","error");return}if(!e.trim()||e.trim().length<5){showStatus("ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ù„Ù„Ù…Ù‚Ø§Ù„","error"),titleInput.focus();return}let h=countArabicWords(f),i=countParagraphs(f);if(h<150){showStatus(`Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù‚Ø§Ù„. ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ${h} ÙƒÙ„Ù…Ø©.`,"error"),articleTextarea.focus();return}if(i<3&&(showStatus(`ØªØ­Ø°ÙŠØ±: Ø§Ù„Ù…Ù‚Ø§Ù„ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ${i} ÙÙ‚Ø±Ø§Øª.`,"warning"),!confirm("Ø§Ù„Ù…Ù‚Ø§Ù„ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 3 ÙÙ‚Ø±Ø§Øª. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„Ù‡ØŸ"))){articleTextarea.focus();return}currentSubmissionData={student_id:c,weekly_topic:d,title:e,article:f},showStatus("ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù‚Ø§Ù„...","loading"),submitBtn.disabled=!0,submitBtn.innerHTML="ØªØ­Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…...",resultsContainer.classList.add("hidden");let j={student_id:c,weekly_topic:d,title:e,article:f};try{let k=await fetch(WEBHOOK_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)});if(!k.ok)throw new Error(`HTTP error! status: ${k.status}`);let l=await k.json();currentResultData=l,showStatus("ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­!","success"),displayResults(l)}catch(a){console.error("Error:",a),showStatus("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù‚Ø§Ù„.","error")}finally{submitBtn.disabled=!1,submitBtn.innerHTML="Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù‚Ø§Ù„ Ù„Ù„ØªÙ‚ÙŠÙŠÙ…"}});function showStatus(a,b){statusText.textContent=a;let c,d;switch(b){case"success":c="bg-green-100 border border-green-300",d="text-green-800";break;case"error":c="bg-red-100 border border-red-300",d="text-red-800";break;case"warning":c="bg-yellow-100 border border-yellow-300",d="text-yellow-800";break;case"loading":c="bg-gray-100 border border-gray-300",d="text-gray-800"}statusMessage.className=`mt-6 p-5 rounded-xl ${c}`,statusText.className=`text-center font-semibold text-base ${d}`,statusMessage.classList.remove("hidden")}function highlightErrors(a){return a.replace(/"([^"]+)"/g,'<span style="color:#dc3545;font-weight:700">$1</span>')}function parseFeedbackSections(a){let b={summary:"",skillErrors:[],otherErrors:[],analysis:[],tips:[]};if(!a)return b;let c=a.includes("Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø©")||a.includes("ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ø±Ø©")||a.includes("Ù†ØµØ§Ø¦Ø­ Ù„Ù„ØªØ­Ø³ÙŠÙ†");if(!c){b.summary=a;return b}let d=a.split("\n"),e=null,f="",g=[];for(let h of d){let i=h.trim();if(i.startsWith("Ø§Ù„Ù…Ù„Ø®Øµ")||i.includes("**Ø§Ù„Ù…Ù„Ø®Øµ**")||i.includes("Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…")){e&&(f.trim()&&(e==="summary"?b.summary=f.trim():e==="analysis"||e==="tips"?g.length>0?(e==="analysis"?b.analysis.push(...g):b.tips.push(...g),g=[]):f.trim()&&(e==="analysis"?b.analysis.push(f.trim()):b.tips.push(f.trim())):e==="skillErrors"?g.length>0?(b.skillErrors.push(...g),g=[]):f.trim()&&b.skillErrors.push(f.trim()):e==="otherErrors"&&(f.trim()&&b.otherErrors.push(f.trim()))),f="",g=[]),e="summary";continue}if(i.includes("Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø©")||i.includes("**(Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©)**")){e&&(e==="skillErrors"?g.length>0&&(b.skillErrors.push(...g),g=[]):f.trim()&&(e==="summary"?b.summary=f.trim():e==="analysis"?b.analysis.push(f.trim()):e==="tips"&&b.tips.push(f.trim())),f=""),e="skillErrors",g=[];continue}if(i.includes("Ø£Ø®Ø·Ø§Ø¡ Ù„ØºÙˆÙŠØ© Ø£Ø®Ø±Ù‰")){e&&(e==="skillErrors"?g.length>0&&(b.skillErrors.push(...g),g=[]):f.trim()&&(e==="summary"?b.summary=f.trim():e==="analysis"?b.analysis.push(f.trim()):e==="tips"&&b.tips.push(f.trim())),f=""),e="otherErrors";continue}if(i.includes("ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ø±Ø© Ø§Ù„Ù„ØºÙˆÙŠØ©")||i.includes("ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡")){e&&(e==="skillErrors"?g.length>0?(b.skillErrors.push(...g),g=[]):f.trim()&&b.skillErrors.push(f.trim()):e==="otherErrors"?f.trim()&&b.otherErrors.push(f.trim()):e==="summary"&&f.trim()&&(b.summary=f.trim()),f=""),e="analysis",g=[];continue}if(i.includes("Ù†ØµØ§Ø¦Ø­ Ù„Ù„ØªØ­Ø³ÙŠÙ†")){e&&(e==="skillErrors"?g.length>0?(b.skillErrors.push(...g),g=[]):f.trim()&&b.skillErrors.push(f.trim()):e==="otherErrors"?f.trim()&&b.otherErrors.push(f.trim()):e==="analysis"?g.length>0?(b.analysis.push(...g),g=[]):f.trim()&&b.analysis.push(f.trim()):e==="summary"&&f.trim()&&(b.summary=f.trim()),f=""),e="tips",g=[];continue}if(!i||i.match(/^\*+$/))continue;if(e==="skillErrors"&&i.match(/^\d+\.?\s*Ø§Ù„Ø®Ø·Ø£/)){f.trim()&&g.push(f.trim()),f=i.replace(/^\d+\.?\s*/,"");continue}if(e==="skillErrors"&&i.startsWith("â€¢")){f+=" "+i;continue}if((e==="analysis"||e==="tips")&&i.match(/^\d+\.?\s*\S/)){f.trim()&&g.push(f.trim()),f=i.replace(/^\d+\.?\s*/,"");continue}if((e==="analysis"||e==="tips")&&i.match(/^\d+\.?\s*$/)){continue}f+=(f?" ":"")+i}e&&(f.trim()&&(e==="summary"?b.summary=f.trim():e==="skillErrors"?g.push(f.trim()):e==="otherErrors"?b.otherErrors.push(f.trim()):e==="analysis"?g.push(f.trim()):e==="tips"&&g.push(f.trim())),g.length>0&&(e==="skillErrors"?b.skillErrors.push(...g):e==="analysis"?b.analysis.push(...g):e==="tips"&&b.tips.push(...g)));return b}function displayResults(a){console.log("Received:",a);let b=Math.round(parseFloat(a.lexical_density)/10);document.getElementById("rating").textContent=`${b}/10`,document.getElementById("wordCountMetric").textContent=a.word_count?a.word_count:"ØºÙŠØ± Ù…ØªÙˆÙØ±",document.getElementById("lexicalDiversity").textContent=a.lexical_diversity?`${(parseFloat(a.lexical_diversity)/10).toFixed(1)}%`:"ØºÙŠØ± Ù…ØªÙˆÙØ±",document.getElementById("lexicalDensity").textContent=a.lexical_density?`${(parseFloat(a.lexical_density)/10).toFixed(1)}%`:"ØºÙŠØ± Ù…ØªÙˆÙØ±",document.getElementById("structureCount").textContent=a.paragraph_count?a.paragraph_count:"ØºÙŠØ± Ù…ØªÙˆÙØ±";let c=a.gemini_feedback||"Ø´ÙƒØ±Ø§Ù‹ Ù„Ø¥Ø±Ø³Ø§Ù„ Ù…Ù‚Ø§Ù„Ùƒ.",d=parseFeedbackSections(c),e=document.getElementById("feedbackSections");e.innerHTML="",d.summary&&(e.innerHTML+=`<div class="section-card summary"><div class=section-title>Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</div><div class=section-content>${highlightErrors(d.summary)}</div></div>`);if(d.skillErrors.length>0){let f='<div class="section-card priority-errors"><div class="section-title priority">Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ø§Ù„Ù…Ù‡Ø§Ø±Ø© (Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©)</div>';d.skillErrors.forEach((g,h)=>{let i=g.split(/\s*â€¢\s*/).filter(j=>j.trim());let k=i[0]||"";let l=i.slice(1);f+=`<div class="error-box"><div style="font-weight:700;margin-bottom:8px">${h+1}. ${highlightErrors(k)}</div>`;l.forEach(m=>{m.trim()&&(f+=`<div style="margin-right:20px;margin-top:6px;line-height:1.6">â€¢ ${highlightErrors(m)}</div>`)}),f+="</div>"}),f+="</div>",e.innerHTML+=f}if(d.otherErrors.length>0){let f='<div class="section-card other-errors"><div class=section-title>Ø£Ø®Ø·Ø§Ø¡ Ù„ØºÙˆÙŠØ© Ø£Ø®Ø±Ù‰ (Ø¥Ù† ÙˆÙØ¬Ø¯Øª)</div>';d.otherErrors.forEach(g=>{let h=g.split(/\s*-\s*/).filter(i=>i.trim());h.forEach(i=>{i.trim()&&(f+=`<div class=error-box>â€¢ ${highlightErrors(i)}</div>`)})}),f+="</div>",e.innerHTML+=f}if(d.analysis.length>0){let f='<div class="section-card analysis"><div class="section-title analysis-title">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</div>',g=1;d.analysis.forEach(h=>{f+=`<div class=numbered-item><div class=number-badge>${g}</div><div class=item-text>${highlightErrors(h)}</div></div>`,g++}),f+="</div>",e.innerHTML+=f}if(d.tips.length>0){let f='<div class="section-card tips"><div class="section-title tips-title">Ù†ØµØ§Ø¦Ø­ Ù„Ù„ØªØ­Ø³ÙŠÙ†</div>',g=1;d.tips.forEach(h=>{f+=`<div class=numbered-item><div class="number-badge tip">${g}</div><div class=item-text>${h}</div></div>`,g++}),f+="</div>",e.innerHTML+=f}!d.summary&&0===d.skillErrors.length&&0===d.otherErrors.length&&0===d.analysis.length&&0===d.tips.length&&(e.innerHTML=`<div class=section-card><div class=section-title>Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</div><div class=section-content>${highlightErrors(c)}</div></div>`),resultsContainer.classList.remove("hidden"),setTimeout(()=>{resultsContainer.scrollIntoView({behavior:"smooth",block:"start"})},300)}updateCounts()</script></body></html>
